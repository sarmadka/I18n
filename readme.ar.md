<div dir=rtl>

# I18n
[[English]](readme.md)

مكتبة لتمكين ترجمة النصوص المستخدمة في واجهات المستخدم. هذه المكتبة تحمل الترجمات من ملفات PO.

## الاستخدام

* أضف المكتبة إلى المشروع باستخدام مدير حزم الأسس:

```
اشمل "مـحا"؛
مـحا.اشمل_ملف("Alusus/I18n"، "تـرجمة.أسس")؛
```

<div dir=ltr>

```
import "Apm";
Apm.importFile("Alusus/I18n");
```

</div>

* أنشئ كائنا من صنف `قـاموس` (`Dictionary`) ثم هيئه باستخدام ملف PO:

```
عرف قاموس: تـرجمة.قـاموس؛
قاموس.هيئ(محتوى_po)؛
```

<div dir=ltr>

```
def dict: I18n.Dictionary;
dict.initialize(poContent);
```

</div>

أو، لتهيئة القاموس من ملف:

```
عرف قاموس: تـرجمة.قـاموس؛
قاموس.هيئ(مـتم.نـم.اقرأ_ملف("en.po"))؛
```

<div dir=ltr>

```
def dict: I18n.Dictionary;
dict.initialize(Srl.Fs.readFile("lang.po"));
```

</div>

يمكن أيضًا تحميل النصوص من عدة ملفات PO باستخدام دالة `أضف` (`add`):

```
قاموس.أضف(محتوى_po)؛
```

<div dir=ltr>

```
dict.add(poContent);
```

</div>

أو

```
قاموس.أضف(مـتم.نـم.اقرأ_ملف("en.po"))؛
```

<div dir=ltr>

```
dict.add(Srl.Fs.readFile("lang.po"));
```

</div>

ويمكن استخدام دالة `فرغ` (`clear`) لمحو كل النصوص المحملة.

* استبدل القاموس بسلاسل المحارف المضمنة:

```
طـرفية.اطبع(قاموس("نصي المترجم"))؛
```

<div dir=ltr>

```
Console.print(dict("My localized string"));
```

</div>

## معرفة اتجاه اللغة

لمعرفة اتجاه اللغة، اي معرفة إن كانت تكتب من اليمين أو اليسار، نستخدم دالة `هل_اللغة_يمينية` (`isRightToLeft`):

```
تـرجمة.هل_اللغة_يمينية(نـص("ar")) // ترجع 1
تـرجمة.هل_اللغة_يمينية(نـص("ar_EG")) // ترجع 1
تـرجمة.هل_اللغة_يمينية(نـص("en")) // ترجع 0
```

<div dir=ltr>

```
I18n.isRightToLeft(String("ar")) // returns true
I18n.isRightToLeft(String("ar_EG")) // returns true
I18n.isRightToLeft(String("en")) // returns false
```

</div>

## صنف مـوارد_نصية (TextAssets)

يمكّنك هذا الصنف من تحميل ملفات نصية بعدة لغات من مجلد وتوفيرها تلقائيا كصنف يحتوي خصلة نصية لكل من
هذه الملفات، ثم يحملها لك تلقائيا مقسمة إلى لغات حسب المجلدات المتوفرة. يستقبل هذا الصنف القالب
أربع معطيات:
1. نص: مسار مجلد الموارد النصية.
2. نص: اللغة المبدئية.
3. صنف: الصنف المستخدم للمتغيرات التي ستحمل البيانات المحملة، وهو مبدئيا `نـص` (`String`).
4. دالة: دالة لتهيئة المتغيرات. مبدئيا يستخدم الصنف دالة تحمل البيانات مسبقًا أثناء الترجمة.
يطلب هذا الصنف أن يحتوي مجلد الموارد النصية على مجلد لكل لغة برمز اللغة كاسم الجلد، وفي كل من هذه
المجلدات توضع الملفات النصية بنفس الأسماء لكل اللغات. سيعرف الصنف متغيرا لكل من هذه الملفات وسيَحمل
المتغير اسم الملف بدون الامتداد.

```
صنف مـوارد_نصية [المسار: نص، رمز_اللغة_المبدئية: نص، صـنف_البيانات: صنف، مهيئ_المتغيرات: دالة]
```

<div dir=ltr>

```
class TextAssets [path: string, defaultLangCode: string, DataType: type, varInitializer: func]
```

</div>

**ملاحظة:**
مبدئيا، هذا الصنف سيحمل الموارد كلها ولكل اللغات أثناء الترجمة وليس أثناء التنفيذ، ما يتيح استخدامه
لترجمة واجهات المستخدم في تطيبقات الويب، لكنه يتيح أيضًا تغيير أسلوب التهيئة كما هو مبين لاحقًا.

على سبيل المثال، إذا كان لديك المجلد التالي:

<div dir=ltr>

```
assets/
  en/
    file1.txt
    file2.txt
    strings.po
  ar/
    file1.txt
    file2.txt
    strings.po
```

</div>

فبعد تهيئة الصنف سيكون لديك صنف يحتوي على `تـطبيق` (`Map`) فيه مفتاحين: ar و en، ولكل مفتاح نموذج من
الصنف. والصنف في هذه الحالة سيحتوي على ثلاثة متغيرات من صنف `نـص` (`String`) وهي: file1 و file2
و strings.

لتهيئة واستخدام الصنف:

```
عرف موارد_نصية: تـرجمة.مـوارد_نصية["./الموارد_النصية"، "ar"]؛
موارد_نصية.هيئ()؛
موارد_نصية.حدد_اللغة_الحالية(اللغة_الحالية)؛
عرف النصوص: نـص = موارد_نصية.الحالي.النصوص؛
تـرجمة.هيئ_النصوص(النصوص)؛
طـرفية.اطبع("%s\ج"، تـرجمة.نص("مثال نصي"))؛
```

<div dir=ltr>

```
def textAssets: I18n.TextAssets["./text_assets", "en"];
textAssets.initialize();
textAssets.setCurrentLanguage(currentLang);
def strings: String = textAssets.current.strings;
I18n.initializeStrings(strings);
Console.print("%s\n", I18n.string("string example"));
```

</div>

يمكن الوصول إلى رمز اللغة الحالية باستخدام المتغير `اللغة_الحالية` (`currentLanguage`). يفضل الاعتماد
على هذا المتغير لأنه يضمن عدم استخدام لغة غير متوفرة ضمن الترجمات الحالية. مثلا، لو استدعيت دالة
`حدد_اللغة_الحالية` (`setCurrentLanguage`) برمز لغة غير متوفر ضمن الترجمات فإن الصنف سيختار اللغة
المبدئية بدل اختيار لغة لا ترجمة لها.

### مـوارد_نصية.هات_اللغات_المتوفرة (TextAssets.getAvailableLanguages)

ترجع هذه الدالة قائمة باللغات المتوفرة. يجب أن تُستدعى دالة `هيئ` (`initialize`) قبل استدعاء هذه
الدالة. تحرص هذه الدالة على وضع اللغة المبدئية في مقدمة المصفوفة المرجعة.

```
دالة هات_اللغات_المتوفرة(): مـصفوفة[نـص]؛
```

<div dir=ltr>

```
func getAvailableLanguages(): Array[String];
```

</div>

### التحكم بأسلوب تهيئة البيانات

لاحظ أننا في الأمثلة أعلاه لم نوفر المعطى الثالث للقالب، وهو `مهيئ_المتغيرات` (`varInitializer`) وذلك
لأنه لهذا المعطى قيمة مبدئية تعمل على تضمين البيانات في البرنامج التنفيذي نفسه، لكن بإمكان المستخدم
توفير دالة مختلفة تعمل على تهيئة المتغيرات بطريقة مختلفة، كأن تحمل البيانات أثناء التنفيذ بدل
تضمينها في البرنامج التنفيذي. لهذه الدالة الصيغة التالية:

```
دالة مهيئة_المتغيرات(اسم_المتغير: نـص، المسار: نـص، المجلد: نـص، اسم_الملف: نـص): سـندنا[كـائن_بهوية]؛
```

<div dir=ltr>

```
func varInitializer(varName: String, path: String, dir: String, filename: String): SrdRef[TiObject];
```

</div>

كل ما تحتاج هذه الدالة لفعله هو إرجاع عبارة ش.ب.م (AST) تهيئ المتغير ذي الاسم المعطى.
تستلم الدالة المعطيات التالية:
* `اسم_المتغير` (`varName`): اسم المتغير المراد تهيئته.
* `المسار` (`path`): المسار إلى المجلد الرئيسي الذي يحتوي الموارد.
* `المجلد` (`dir`): اسم المجلد الفرعي ضمن المسار، وهو المجلد المتعلق باللغة التي تتم تهيئتها حاليا.
* `اسم_الملف` (`filename`): اسم الملف الموافق للمتغير الذي تتم تهيئته.

### صنف نـموذج_موارد_نصية (TextAssetsInstance)

هذا الصنف هو الصنف الذي يحمل الموارد النصية للغة محددة. الصنف `مـوارد_نصية` (`TextAssets`) يحمل مجموعة
من كائنات هذا الصنف، واحد لكل لغة.

```
صنف نـموذج_موارد_نصية [المسار: نص، رمز_اللغة_المبدئية: نص، صـنف_البيانات: صنف]
```

<div dir=ltr>

```
class TextAssetsInstance [path: string, defaultLangCode: string, DataType: type]
```

</div>

</div>

